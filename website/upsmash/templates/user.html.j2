{% extends 'base.html.j2' %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/user.css') }}">
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/user.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
{% endblock %}

{% set title=username %}

{% block body %}
<div class="content">
  <div class="flexbox-container flexbox-container1 ">
    <div class="flexbox-item flexbox-item-1">
      <h2>{{ player.username }} <img src="{{ url_for('static', filename=character_image_location) }}" alt="character_icon" style="height: 30px; width: 30px;"></h2>
      <p>{{ player.connect_code }}</p>
      <h5>Current Rating: {{ player.current_rating | int }}</h5>
      <h5>Ranked: <span style="color: #00FF00">{{ player.ranked_wins }}</span>/<span style="color:#FF0000">{{ player.ranked_losses }}</span></h5>
      <h5>Unranked: <span style="color: #00FF00">{{ wins }}</span>/<span style="color:#FF0000">{{ losses }}</span></h5>
      <h5>Total SLP Files: {{ total_games }}</h5>
    </div>
    <div class="flexbox-item flexbox-item-2">
      <div class="flexbox-container  flexbox-container4">
        <div class="flexbox-item flexbox-item-3">
          <div class="flexbox-item chartBox">
            <canvas id="myChart"></canvas>
          </div>
        </div>
      </div>
      <div class="flexbox-container flexbox-container2">
        {% if slippi_replays|length %}
          {% for replay in slippi_replays %}
            {% set win = replay.winner_id == player.id %}
            {% set playersOverall = replay.get_player_overall_ordered(player.id)%}
            <div class="flexbox-item flexbox-item-second" id="test">
              <div class="flexbox-container flexbox-container3">
                <div class="flexbox-item flexbox-player flexbox-player-left" {% if win %}style="background-color: #59AD1E;"{% else %}style="background-color: #AD1E1E;"{% endif %}>
                  <h5>{{ playersOverall[0].player.username }}</h5>
                  <p>Kills: {{ playersOverall[0].kill_count }}</p>
                  <p>Openings per Kill: {% if playersOverall[0].openings_per_kill is not none %}{{ playersOverall[0].openings_per_kill | float | round(1) }}{% endif %}</p>
                  <p>Damage per Opening: {% if playersOverall[0].damage_per_opening is not none %}{{ playersOverall[0].damage_per_opening | round(1) }}{% endif %}</p>
                </div>
                <div class="flexbox-item flexbox-player flexbox-player-right" {% if win  %}style="background-color: #59AD1E;"{% else %}style="background-color: #AD1E1E;"{% endif %}>
                  <h5>{{ playersOverall[1].player.username }}</h5>
                  <p>Kills: {{ playersOverall[1].kill_count }}</p>
                  <p>Openings per Kill: {% if playersOverall[1].openings_per_kill is not none %}{{ playersOverall[1].openings_per_kill | float | round(1) }}{% endif %}</p>
                  <p>Damage per Opening: {% if playersOverall[1].damage_per_opening is not none %}{{ playersOverall[1].damage_per_opening | round(1) }}{% endif %}</p>
                </div>
                <div class="detailPanel">
                  <button class="detail"></button>
                </div>

              </div>

              <div class="flexbox-container" id="matchDetail">
              
                <h5>Game Stats</h5>
                <div id="detailWrapper">
                  <div class="detail"> Total Inputs: </div>
                    <div class="stat"> {{playersOverall[0].input_counts}} </div>
                  <div class="detail"> Damage Dealt: </div>
                    <div class="stat"> {{playersOverall[0].total_damage|round(1, 'common')}} </div>
                  <div class="detail"> Kill Count: </div>
                    <div class="stat"> {{playersOverall[0].kill_count}} </div>
                  <div class="detail"> Successful Conversions: </div>
                    <div class="stat"> {{playersOverall[0].successful_conversions}} </div>
                  <div class="detail"> Conversion Ratio: </div>
                    {%set conversionRatio = playersOverall[0].successful_conversion_ratio|float * 100%}
                    <div class="stat"> {{conversionRatio |round(2,'common')}}%</div>
                  <div class="detail"> Damage Dealt: </div>
                    <div class="stat"> {{playersOverall[0].total_damage|round(1, 'common')}} </div>
                
                </div>
              
              </div>


            </div>
          {% endfor %}
        {% else %}
            <div class="flexbox-item flexbox-item-second" style="padding: 10px;padding-top: 5px;">
              <div class="flexbox-container flexbox-container3">
              <h5>No SLP files found</h5>
              </div>
            </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<script>
const datapoints = [
      {% for row in data_items %}
      {x: new Date('{{ row[0] | safe }}'), y: {{ row[1] | safe }} },
      {% endfor %}
];
</script>
<script src="../static/js/elo_graph.js"></script>
{% endblock %}